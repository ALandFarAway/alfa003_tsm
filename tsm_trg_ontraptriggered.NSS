////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_trg_ontraptriggered.nss
//    $Revision:: 236        $ current version of the file
//        $Date:: 2007-01-21#$ date the file was created or modified
//       Author : Cipher
//
//   Var Prefix :
//  Dependencies:
//
//  Description
//  This script calls the ACR's OnTrapTriggered code for triggers, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
//  2007/01/20  � i p h � r  Inception
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_trigger_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "x0_i0_spells"

void main()
{
    ACR_TriggerOnTrapTriggered();

    // Custom code goes here.
	object oPlaceable = GetNearestObjectByTag(GetTag(OBJECT_SELF) + "_plc", OBJECT_SELF, 1);
	SendMessageToAllDMs("OBJECT_SELF = " + GetTag(OBJECT_SELF));
	SendMessageToAllDMs("oPlaceable = " + GetTag(oPlaceable));
	SendMessageToAllDMs("EnteringObject = " + GetName(GetEnteringObject()));
	
	
	if(GetTag(OBJECT_SELF) == "003_trap_spike_minor")
		{//SendMessageToPC(GetEnteringObject(), "Gotcha!");
		 AssignCommand(oPlaceable, ActionPlayAnimation(ANIMATION_PLACEABLE_OPEN, 1.0));
		 if(ReflexSave(GetEnteringObject(), 15, SAVING_THROW_TYPE_TRAP))
		 	{}
		 else
			 {DoTrapSpike(d6(2));}
		 DelayCommand(2.0, AssignCommand(oPlaceable, ActionPlayAnimation(ANIMATION_PLACEABLE_CLOSE, 1.0)));
		 
		 }
}