////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_door_onunlock 
//    $Revision:: 233        $ current version of the file
//        $Date:: 2007-01-20#$ date the file was created or modified
//       Author : Ronan
//
//  Local Variable Prefix =
//
//
//  Dependencies external of nwscript:
//
//  Description
//  This script calls the ACR's OnUnlock code for doors, and any custom code
//  a server may need. It is not updated in ACR updates.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_door_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main() {
    ACR_DoorOnUnlock();
	
	object oGeasWP = GetObjectByTag("Occ_Geas_WP", 0);
	object oGlyphWP = GetObjectByTag("occ_plc_glyph_warding_wp", 0);
	object oPC = GetLastUnlocked();
	int eLevel = GetTotalLevels(oPC, FALSE);
	
	 if((GetLocalInt(OBJECT_SELF, "Fired") == 0) && (eLevel < 8) && (GetTag(OBJECT_SELF) == "plc_dc_gtdra03"))
        {if(WillSave(oPC,17, SAVING_THROW_TYPE_MIND_SPELLS, OBJECT_SELF))
			{SendMessageToPC(oPC, "A strange sensation passes through you, as if you feel a momentary impulse to turn around...but it passes." );
			}
			
		else if (GetTag(OBJECT_SELF) == "plc_dc_gtdra03")
			 {SetLocalInt(OBJECT_SELF, "Fired", 1);
			  AssignCommand(oPC, ActionMoveToObject(oGeasWP, TRUE, 1.0));
	          SendMessageToPC(oPC, "You find yourself turning around, suddenly convinced that you must go find out what lies to the south, around the corner of the tunnel and to the east. You can think and speak as normal, but the compulsion to move south and east is irresistable." );
			  CreateObject(OBJECT_TYPE_CREATURE, "abr_cr_vm_spider_huge", GetLocation(oGeasWP));
			  object oGlyph = CreateObject(OBJECT_TYPE_PLACEABLE, "occ_plc_glyph_warding", GetLocation(oGlyphWP));
			  DestroyObject(oGlyph, 6.0);
			  }
		 	}

}